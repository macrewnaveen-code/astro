---
// LanguageSwitcher.astro - Reusable language switcher component
import { getSupportedLanguages } from '../i18n';

interface Props {
  currentLang?: string;
  showLabel?: boolean;
  className?: string;
}

const {
  currentLang = 'en',
  showLabel = true,
  className = ''
} = Astro.props;

const supportedLanguages = getSupportedLanguages();

const languageNames: Record<string, string> = {
  en: 'ðŸ‡ºðŸ‡¸ English',
  fr: 'ðŸ‡«ðŸ‡· FranÃ§ais',
  es: 'ðŸ‡ªðŸ‡¸ EspaÃ±ol',
  'pt-br': 'ðŸ‡§ðŸ‡· PortuguÃªs',
  ar: 'ðŸ‡¸ðŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©'
};
---

<div class={`language-switcher ${className}`}>
  {showLabel && (
    <span class="lang-label">Language:</span>
  )}
  <div class="lang-buttons">
    {supportedLanguages.map((lang) => (
      <button
        class={`lang-btn ${lang === currentLang ? 'active' : 'inactive'}`}
        data-lang={lang}
        aria-pressed={lang === currentLang}
        aria-label={`Switch to ${languageNames[lang] || lang}`}
      >
        {languageNames[lang] || lang.toUpperCase()}
      </button>
    ))}
  </div>
</div>

<style>
  .language-switcher {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
  }

  .lang-label {
    font-weight: 600;
    color: #333;
    font-size: 0.95rem;
    white-space: nowrap;
  }

  .lang-buttons {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .lang-btn {
    padding: 8px 14px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 500;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    font-family: inherit;
  }

  .lang-btn.active {
    background: #0066cc;
    color: white;
    box-shadow: 0 2px 8px rgba(0, 102, 204, 0.3);
  }

  .lang-btn.inactive {
    background: #f0f0f0;
    color: #666;
  }

  .lang-btn.inactive:hover {
    background: #e8e8e8;
    color: #333;
  }
</style>

<script>
  // Language button clicks are now handled by dynamicTranslate.ts
  // This script just manages button state display
  
  // On page load, check for saved language preference and highlight the button
  document.addEventListener('DOMContentLoaded', () => {
    const savedLang = localStorage.getItem('preferred-language');
    if (savedLang) {
      document.querySelectorAll('.lang-btn').forEach((btn) => {
        const btnLang = btn.getAttribute('data-lang');
        if (btnLang === savedLang) {
          btn.classList.add('active');
          btn.classList.remove('inactive');
          btn.setAttribute('aria-pressed', 'true');
        } else {
          btn.classList.remove('active');
          btn.classList.add('inactive');
          btn.setAttribute('aria-pressed', 'false');
        }
      });
    }
  });

  // Listen for language change events from dynamicTranslate.ts
  window.addEventListener('page-translated', (e: any) => {
    const newLang = e.detail?.lang;
    if (newLang) {
      document.querySelectorAll('.lang-btn').forEach((btn) => {
        const btnLang = btn.getAttribute('data-lang');
        if (btnLang === newLang) {
          btn.classList.add('active');
          btn.classList.remove('inactive');
          btn.setAttribute('aria-pressed', 'true');
        } else {
          btn.classList.remove('active');
          btn.classList.add('inactive');
          btn.setAttribute('aria-pressed', 'false');
        }
      });
    }
  });
</script>
