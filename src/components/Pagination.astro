---
interface Props {
  currentPage: number;
  totalPages: number;
  baseUrl?: string;
}

const { currentPage, totalPages, baseUrl = '' } = Astro.props;

// Smart pagination - show max 7 page numbers
// Show: first, prev-2, prev-1, current, next+1, next+2, last
const getPageNumbers = () => {
  const pages: (number | string)[] = [];
  const maxButtons = 7;
  
  if (totalPages <= maxButtons) {
    // Show all pages if total is small
    return Array.from({ length: totalPages }, (_, i) => i + 1);
  }
  
  // Always show first page
  pages.push(1);
  
  // Calculate range around current page
  let startPage = Math.max(2, currentPage - 2);
  let endPage = Math.min(totalPages - 1, currentPage + 2);
  
  // Add ellipsis if needed
  if (startPage > 2) {
    pages.push('...');
  }
  
  // Add pages around current
  for (let i = startPage; i <= endPage; i++) {
    pages.push(i);
  }
  
  // Add ellipsis if needed
  if (endPage < totalPages - 1) {
    pages.push('...');
  }
  
  // Always show last page
  pages.push(totalPages);
  
  return pages;
};

const getPageUrl = (page: number) => {
  // If a baseUrl is provided, respect that (e.g. /category/food)
  if (baseUrl) {
    const clean = baseUrl.replace(/\/$/, '');
    return page === 1 ? clean || '/' : `${clean}/page/${page}`;
  }

  // Default: use query param style on current root path (/?page=2)
  return page === 1 ? '/' : `/?page=${page}`;
};

const pageNumbers = getPageNumbers();
---

<nav class="flex flex-wrap gap-2 mt-12 mb-8">
  {/* Previous Button */}
  {currentPage > 1 && (
    <a 
      href={getPageUrl(currentPage - 1)}
      class="px-4 py-2 rounded-lg bg-gradient-to-r from-orange-500 to-orange-600 text-white font-semibold hover:from-orange-600 hover:to-orange-700 transition-all shadow-md hover:shadow-lg flex items-center gap-2"
      title="Previous page"
    >
      <i class="fas fa-chevron-left"></i> Prev
    </a>
  )}
  
  {/* Page Numbers */}
  <div class="flex flex-wrap gap-1 justify-center">
    {pageNumbers.map((page) => {
      if (page === '...') {
        return (
          <span class="px-2 py-2 text-gray-500 dark:text-gray-400 font-semibold">
            ...
          </span>
        );
      }
      
      const pageNum = page as number;
      const isActive = pageNum === currentPage;
      
      return (
        <a 
          href={getPageUrl(pageNum)}
          class={`px-3 py-2 rounded-lg font-semibold transition-all ${
            isActive
              ? 'bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-lg scale-105'
              : 'bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-white hover:bg-gray-300 dark:hover:bg-gray-600 shadow hover:shadow-md'
          }`}
          title={`Go to page ${pageNum}`}
          aria-label={`Page ${pageNum}`}
          aria-current={isActive ? 'page' : undefined}
        >
          {pageNum}
        </a>
      );
    })}
  </div>
  
  {/* Next Button */}
  {currentPage < totalPages && (
    <a 
      href={getPageUrl(currentPage + 1)}
      class="px-4 py-2 rounded-lg bg-gradient-to-r from-orange-500 to-orange-600 text-white font-semibold hover:from-orange-600 hover:to-orange-700 transition-all shadow-md hover:shadow-lg flex items-center gap-2"
      title="Next page"
    >
      Next <i class="fas fa-chevron-right"></i>
    </a>
  )}
</nav>

{/* Stats */}
<!-- <div class="flex justify-center items-center gap-4 text-sm text-gray-600 dark:text-gray-400 mb-4">
  <span class="font-semibold">
    Page {currentPage} of {totalPages}
  </span>
  <span class="text-xs bg-gray-200 dark:bg-gray-700 px-2 py-1 rounded">
    {totalPages > 1 ? `${totalPages} pages total` : '1 page'}
  </span>
</div> -->

<style>
  nav {
    animation: fadeIn 0.3s ease-in;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Responsive adjustments */
  @media (max-width: 640px) {
    nav {
      gap: 0.5rem;
    }
    
    :global(a, span) {
      padding: 0.5rem 0.75rem;
      font-size: 0.875rem;
    }
  }
</style>
