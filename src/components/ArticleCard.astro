---
import { processArticleImageUrl } from '../utils/cdnUrlReplacer';

interface Props {
  article: {
    id: number;
    slug: string;
    title: {
      rendered: string;
    };
    excerpt: {
      rendered: string;
    };
    featured_media?: number;
    date?: string;
    featured_image_url?: string;
    author?: number;
  };
}

const { article } = Astro.props;

// Extract plain text from HTML excerpt
const plainExcerpt = article.excerpt.rendered
  .replace(/<[^>]*>/g, '')
  .trim()
  .substring(0, 150) + '...';

const articleTitle = article.title.rendered.replace(/<[^>]*>/g, '');
const articleUrl = `/${article.slug}/`;
const imageSrc = processArticleImageUrl(article) || 'https://via.placeholder.com/400x300?text=' + encodeURIComponent(articleTitle);

// Get author name
const getAuthorName = () => {
  if (!article.author) return 'La Cuisine De Bernard';
  const author = authorsData.find((a: any) => a.user_id === article.author);
  return author ? author.display_name : 'La Cuisine De Bernard';
};

const authorName = getAuthorName();

// Format date
const formattedDate = article.date 
  ? new Date(article.date).toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'short',
      day: 'numeric'
    })
  : '';
---

<article class="bg-white border border-gray-200 rounded-lg overflow-hidden hover:shadow-lg transition duration-300">
  <!-- Featured Image -->
  <div class="relative h-48 bg-gray-200 overflow-hidden">
    <img
      src={imageSrc}
      alt={articleTitle}
      class="w-full h-full object-cover transition duration-300 hover:scale-105"
      loading="lazy"
    />
  </div>

  <!-- Content -->
  <div class="p-6 flex flex-col h-full">
    <!-- Title -->
    <h3 class="text-lg font-bold text-gray-900 mb-3 line-clamp-2">
      <a href={articleUrl} class="hover:text-blue-600 transition duration-200">
        {articleTitle}
      </a>
    </h3>

    <!-- Meta info (Date | Author) -->
    <div class="text-xs text-gray-600 mb-3 flex items-center gap-2">
      {formattedDate && (
        <>
          <span>{formattedDate}</span>
          <span class="text-gray-400">|</span>
        </>
      )}
      <span>{authorName}</span>
    </div>

    <!-- Excerpt -->
    <p class="text-gray-600 text-sm mb-4 line-clamp-3 flex-grow">
      {plainExcerpt}
    </p>

    <!-- Read More Button -->
    <a
      href={articleUrl}
      class="inline-block px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition duration-200 text-sm font-medium"
    >
      Read More â†’
    </a>
  </div>
</article>

